# テストデータ設計 - Account情報抽出性能検証

## ドキュメント情報

- **最終更新**: 2025-12-03 16:42
- **バージョン**: 2.0
- **対象実装**: iOS 26+, macOS 26+

## 概要

Apple Intelligence Foundation Model（AIFM）のAccount情報抽出性能を検証するため、5つのシチュエーション × 3つのレベル = 15のテストケースを設計します。テストデータファイルには期待フィールドを明示的に定義し、正解データは`expected_answers.json`で管理します。

## テストケース設計

### シチュエーション分類

| シチュエーション | 説明 | 特徴 |
|---|---|---|
| **チャット** | チャットでのやりとりのテキスト | 非公式、略語、感情表現含む |
| **契約書** | 契約書などの書類をコピペしたテキスト | 公式、構造化、法的用語 |
| **クレジットカード** | クレジットカードをスキャンしたテキスト | 数字中心、特定フォーマット |
| **音声認識** | 音声認識による会話のテキスト | 話し言葉、誤認識、不完全文 |
| **パスワード管理** | メジャーなパスワード管理アプリのエクスポートデータ(CSV) | 構造化、複数アカウント、特殊文字 |

### レベル分類

| レベル | 文字数 | 難易度 | 期待される抽出精度 | 説明 |
|---|---|---|---|
| **Level 1** | ~100文字 | 簡単 | 95%以上 | アカウント情報の箇条書き+必要最低限のテキスト |
| **Level 2** | ~300文字 | 中程度 | 80-95% | 一般的会話や書類のテキストにアカウント情報が含まれる |
| **Level 3** | ~1000文字 | 困難 | 60-80% | 複雑な会話や書類のテキストの中にアカウント情報が埋め込まれる |

## テストケース詳細

### 1. チャットシチュエーション

#### Level 1: 基本チャット（等号区切り形式）
- **文字数**: ~100文字
- **内容**: シンプルなアカウント情報の共有
- **含まれる情報**: サービス名、ユーザーID、パスワード
- **特徴**: 等号区切り（user=admin, pass=SecurePass123）、略語、非公式表現

#### Level 2: 一般的チャット（コロン区切り形式）
- **文字数**: ~300文字
- **内容**: 日常会話の中にアカウント情報が含まれる
- **含まれる情報**: サービス名、ユーザーID、パスワード、URL、備考
- **特徴**: コロン区切り（ID: admin, PW: SecurePass123）、会話の流れ、感情表現

#### Level 3: 複雑チャット（技術的表現形式）
- **文字数**: ~1000文字
- **内容**: 長い会話の中に詳細なアカウント情報が埋め込まれる
- **含まれる情報**: 全フィールド（ホスト、ポート、SSH鍵、詳細な備考）
- **特徴**: 技術的表現（login: admin, credential: SecurePass123）、複数の話題、技術的詳細

### 2. 契約書シチュエーション

#### Level 1: 基本契約書（自然な文章形式）
- **文字数**: ~200文字
- **内容**: 契約書の一部（アカウント情報のみ）
- **含まれる情報**: サービス名、ユーザーID、パスワード
- **特徴**: 自然な文章（ユーザー名 user001、認証情報 CompanyPass2024）、公式表現

#### Level 2: 一般的契約書（正式な条項形式）
- **文字数**: ~400文字
- **内容**: 契約書の一部にアカウント情報が含まれる
- **含まれる情報**: サービス名、ユーザーID、パスワード、URL、備考
- **特徴**: 正式な条項（システム名: 社内基幹システム、ログインID: user001）、法的用語

#### Level 3: 複雑契約書（括弧付きセクション形式）
- **文字数**: ~1000文字
- **内容**: 詳細な契約書の中にアカウント情報が埋め込まれる
- **含まれる情報**: 全フィールド（ホスト、ポート、SSH鍵、詳細な備考）
- **特徴**: 括弧付きセクション（【システム情報】、名称: 社内基幹システム）、複雑な条項、技術仕様

### 3. クレジットカードシチュエーション

#### Level 1: 基本カード情報（OCR形式）
- **文字数**: ~50文字
- **内容**: OCRで読み取ったカード情報
- **含まれる情報**: ブランド名、カード番号、有効期限、セキュリティコード、名義人
- **特徴**: 説明なし、ブランド名混在、数字中心、OCR特有の形式

#### Level 2: 一般的カード情報（OCR + 利用条件）
- **文字数**: ~200文字
- **内容**: OCRで読み取ったカード情報と利用条件
- **含まれる情報**: ブランド名、カード番号、有効期限、セキュリティコード、名義人、利用条件
- **特徴**: OCR形式 + 利用規約、注意事項

#### Level 3: 複雑カード情報（OCR + 詳細規約）
- **文字数**: ~900文字
- **内容**: OCRで読み取ったカード情報と詳細な利用規約
- **含まれる情報**: 全フィールド（ブランド名、カード番号、有効期限、セキュリティコード、名義人、詳細な備考、制限事項）
- **特徴**: OCR形式 + 複雑な利用規約、セキュリティ要件、制限事項

### 4. 音声認識シチュエーション

#### Level 1: 基本音声認識（等号区切り形式）
- **文字数**: ~100文字
- **内容**: シンプルな音声認識結果
- **含まれる情報**: サービス名、ユーザーID、パスワード
- **特徴**: 等号区切り（user=admin, pass=SecurePass123）、話し言葉、誤認識

#### Level 2: 一般的音声認識（コロン区切り形式）
- **文字数**: ~300文字
- **内容**: 日常会話の音声認識結果
- **含まれる情報**: サービス名、ユーザーID、パスワード、URL、備考
- **特徴**: コロン区切り（ID: admin, PW: SecurePass123）、会話の流れ、誤認識

#### Level 3: 複雑音声認識（技術的表現形式）
- **文字数**: ~1000文字
- **内容**: 複雑な会話の音声認識結果
- **含まれる情報**: 全フィールド（ホスト、ポート、SSH鍵、詳細な備考）
- **特徴**: 技術的表現（login: admin, credential: SecurePass123）、長い会話、技術的詳細

### 5. パスワード管理シチュエーション

#### Level 1: 基本CSV
- **文字数**: ~100文字
- **内容**: シンプルなCSV形式のアカウント情報
- **含まれる情報**: サービス名、ユーザーID、パスワード
- **特徴**: 構造化、カンマ区切り

#### Level 2: 一般的CSV
- **文字数**: ~300文字
- **内容**: 一般的なCSV形式のアカウント情報
- **含まれる情報**: サービス名、ユーザーID、パスワード、URL、備考
- **特徴**: 複数フィールド、特殊文字、エスケープ

#### Level 3: 複雑CSV
- **文字数**: ~1000文字
- **内容**: 詳細なCSV形式のアカウント情報
- **含まれる情報**: 全フィールド（ホスト、ポート、SSH鍵、詳細な備考）
- **特徴**: 複数アカウント、複雑な構造、特殊文字多数

## テストデータ構造

### ディレクトリ構造

```
Tests/TestData/
├── Chat/
│   ├── Level1_Basic.txt
│   ├── Level2_General.txt
│   └── Level3_Complex.txt
├── Contract/
│   ├── Level1_Basic.txt
│   ├── Level2_General.txt
│   └── Level3_Complex.txt
├── CreditCard/
│   ├── Level1_Basic.txt
│   ├── Level2_General.txt
│   └── Level3_Complex.txt
├── VoiceRecognition/
│   ├── Level1_Basic.txt
│   ├── Level2_General.txt
│   └── Level3_Complex.txt
├── PasswordManager/
│   ├── Level1_Basic.txt
│   ├── Level2_General.txt
│   └── Level3_Complex.txt
└── expected_answers.json  (正解データ)
```

### テストデータファイルの形式

各テストデータファイルは以下の形式で記述します：

```
//expectedFields: field1,field2,field3,...
//author: Test Author (オプション)
//description: Description (オプション)
実際のテストデータテキスト
```

**重要なポイント**:
- **必須**: 先頭に`//expectedFields:`コメントで期待フィールドを指定
- **形式**: `//expectedFields: title,userID,password,note`（カンマ区切り）
- **コメント行**: `//`で始まる行はすべてコメントとして扱われ、抽出処理では除外される
- **クリーンなコンテンツ**: コメント行を除いたテキストが実際のテストデータとして使用される

**例: Chat/Level1_Basic.txt**
```
//expectedFields: title,userID,password,note
//author: Test Author
//description: Basic chat pattern test case
Hey! 新しいサーバーのアカウント情報を送るね

AWS EC2にログインするには
アカウントはadmin/SecurePass18329です
でアクセスできるよ

よろしく！
```

### 正解データファイル（expected_answers.json）

各テストケースの正解データは`Tests/TestData/expected_answers.json`で管理します。

**構造**:
```json
{
  "Chat": {
    "Level1_Basic": {
      "title": "{要AI検証}",
      "userID": "admin",
      "password": "SecurePass18329",
      "url": "",
      "note": "{要AI検証}",
      "host": "",
      "port": "",
      "number": "",
      "authKey": ""
    },
    "Level2_General": {
      ...
    },
    "Level3_Complex": {
      ...
    }
  },
  "Contract": { ... },
  "CreditCard": { ... },
  "VoiceRecognition": { ... },
  "PasswordManager": { ... }
}
```

**重要なポイント**:
- **`{要AI検証}`マーカー**: `title`と`note`フィールドには`{要AI検証}`が設定される
  - これらのフィールドは自由形式の記述が可能なため、AIによる検証が必要
  - 抽出結果の`status`は`pending`として記録され、後でAI検証により`correct`または`wrong`に更新される
- **空文字列**: 期待されないフィールドは空文字列`""`で定義
- **完全一致フィールド**: `userID`, `password`, `url`, `host`, `port`, `authKey`などは完全一致で判定

## 期待される抽出結果

各テストケースに対して、テストデータファイル内の`//expectedFields:`コメントで指定されたフィールドが正しく抽出されることを期待します。

### フィールド定義

| フィールド名 | 説明 | 検証方法 | 例 |
|------------|------|---------|-----|
| `title` | サービス名 | **AI検証**（自由形式の記述が可能） | "AWS EC2", "GitHub" |
| `userID` | ユーザーID/メールアドレス | **完全一致**（期待値と完全一致が必要） | "admin", "user@example.com" |
| `password` | パスワード | **完全一致**（期待値と完全一致が必要） | "SecurePass18329" |
| `url` | ログインURL | **完全一致**（期待値と完全一致が必要） | "https://console.aws.amazon.com" |
| `note` | 備考・メモ | **AI検証**（自由形式の記述が可能） | "AWS EC2にログインするためのアカウント情報。" |
| `host` | ホスト名/IPアドレス | **完全一致**（期待値と完全一致が必要） | "197.78.64.33", "ec2-54-123-45-67.compute-1.amazonaws.com" |
| `port` | ポート番号 | **完全一致**（期待値と完全一致が必要） | "22", "443" |
| `authKey` | 認証キー/SSH鍵 | **完全一致**（期待値と完全一致が必要） | "-----BEGIN OPENSSH PRIVATE KEY-----..." |
| `number` | 識別番号（カード番号、アカウントIDなど） | **完全一致**（期待値と完全一致が必要） | "123456789012" |

### レベル別の期待フィールド

#### Chat（チャット）

**Level 1**:
- `title`, `userID`, `password`, `note`

**Level 2**:
- `title`, `userID`, `password`, `url`, `number`, `note`

**Level 3**:
- `title`, `userID`, `password`, `url`, `note`, `host`, `port`, `authKey`

#### Contract（契約書）

**Level 1**:
- `title`, `userID`, `password`, `note`

**Level 2**:
- `title`, `userID`, `password`, `url`, `note`

**Level 3**:
- `title`, `userID`, `password`, `url`, `note`, `host`, `port`

#### CreditCard（クレジットカード）

**Level 1**:
- `title`, `userID`, `note`

**Level 2**:
- `title`, `userID`, `note`

**Level 3**:
- `title`, `userID`, `note`, `authKey`

#### VoiceRecognition（音声認識）

**Level 1**:
- `title`, `userID`, `password`, `note`

**Level 2**:
- `title`, `userID`, `password`, `url`, `note`, `host`, `port`

**Level 3**:
- `title`, `userID`, `password`, `url`, `note`, `host`, `port`, `authKey`

#### PasswordManager（パスワード管理）

**Level 1**:
- `title`, `userID`, `password`, `note`

**Level 2**:
- `title`, `userID`, `password`, `url`, `note`

**Level 3**:
- `title`, `userID`, `password`, `url`, `note`, `host`, `port`

### 検証方法の分類

#### AI検証が必要なフィールド（pendingステータス）

以下のフィールドは自由形式の記述が可能なため、AIによる検証が必要です：

- **`title`**: サービス名は様々な表現が正しい場合がある
  - 例: "AWS EC2", "Amazon EC2", "EC2インスタンス" など
- **`note`**: 備考は様々な表現が正しい場合がある
  - 例: "AWS EC2にログインするためのアカウント情報。", "EC2サーバーのログイン情報です" など

**検証フロー**:
1. 抽出結果の`status`が`pending`として記録される
2. AIがテストデータと抽出結果を比較して検証
3. `status`を`correct`または`wrong`に更新

#### プログラム判定可能なフィールド（correct/wrong/missingステータス）

以下のフィールドは期待値と完全一致で判定されます：

- **`userID`**: ユーザーID/メールアドレス
- **`password`**: パスワード
- **`url`**: ログインURL
- **`host`**: ホスト名/IPアドレス
- **`port`**: ポート番号
- **`authKey`**: 認証キー/SSH鍵
- **`number`**: 識別番号

**判定ロジック**:
- 抽出値が期待値と完全一致 → `correct`
- 抽出値が期待値と不一致 → `wrong`
- 抽出値がnullまたは空文字列 → `missing`

## 評価指標

### 抽出精度

**フィールド別の精度**:
- **完全抽出**: 全フィールドが正しく抽出された場合（`status: correct`）
- **部分抽出**: 一部フィールドが正しく抽出された場合
- **抽出失敗**: フィールドが抽出されなかった場合（`status: missing`）
- **誤抽出**: 期待されないフィールドが抽出された場合（`unexpected_fields`に記録）

**ステータス別の集計**:
- **correct**: 正しく抽出されたフィールド数
- **wrong**: 抽出されたが値が間違っているフィールド数
- **missing**: 抽出されなかったフィールド数
- **pending**: AI検証待ちのフィールド数（`title`, `note`のみ）
- **unexpected**: 期待されないフィールドが抽出された数

**精度計算式**:
- **正解率**: `correct数 / 期待フィールド数`
- **抽出率**: `(correct数 + wrong数) / 期待フィールド数`
- **精度**: `correct数 / (correct数 + wrong数 + unexpected数)`

### 処理時間（参考値）

処理時間は環境やAIモデルの状態により変動するため、参考値として記録されます：

- **Level 1**: 平均1-3秒
- **Level 2**: 平均2-5秒
- **Level 3**: 平均3-10秒
- **2ステップ抽出**: 平均4-8秒（Step 1: 2-3秒 + Step 2: 2-5秒）

### 信頼度スコア（非推奨）

**注意**: 信頼度スコア（confidence）はAI自己評価のため信頼性が低く、評価指標としては使用しません。

- 実装では`confidence`フィールドは存在しますが、評価には使用されません
- 評価は`status`フィールド（correct, wrong, missing, pending）に基づいて行います

## テストデータファイルの作成・編集ガイドライン

### 必須要件

1. **`//expectedFields:`コメントの必須性**: 
   - すべてのテストデータファイルの先頭に`//expectedFields:`コメントを記述
   - 形式: `//expectedFields: field1,field2,field3,...`
   - カンマ区切りでフィールド名を列挙
   - このコメントがない場合、`fatalError`が発生します

2. **期待フィールドの一貫性**:
   - テストデータファイルの`//expectedFields:`と`expected_answers.json`のフィールド定義を一致させる
   - 期待フィールドに含まれないフィールドが抽出された場合、`unexpected_fields`に記録される

3. **正解データの定義**:
   - `expected_answers.json`にすべてのテストケースの正解データを定義
   - `title`と`note`フィールドには`{要AI検証}`マーカーを設定
   - 期待されないフィールドは空文字列`""`で定義

### 推奨事項

1. **コメントの活用**:
   - `//author:`: テストデータの作成者を記録
   - `//description:`: テストケースの説明を記録
   - これらのコメントは抽出処理では無視されますが、ドキュメントとして有用です

2. **現実性の確保**:
   - 実際の使用場面を想定したリアルなデータを作成
   - 異なる形式や表現を含む多様なデータを用意

3. **個人情報の保護**:
   - テストデータには実際の個人情報は使用しない
   - パスワードや認証キーはダミーデータを使用

4. **セキュリティ**:
   - テストデータに含まれる認証情報はすべてダミーデータ
   - 実際のアカウント情報は使用しない

## 注意事項

1. **ファイル形式**: UTF-8エンコーディングで保存
2. **改行コード**: Unix形式（LF）を推奨
3. **コメント行**: `//`で始まる行はすべてコメントとして扱われ、抽出処理では除外される
4. **期待フィールドの順序**: `//expectedFields:`コメント内のフィールド順序は任意
5. **フィールド名の大文字小文字**: フィールド名は小文字で記述（`title`, `userID`, `password`など）
6. **正解データの更新**: テストデータを変更した場合は、`expected_answers.json`も更新する必要がある

## 更新履歴

- 2025-12-03: **v2.0 大幅更新**
  - テストデータファイルの形式を実装に合わせて更新（`//expectedFields:`コメントの必須化）
  - 正解データファイル（`expected_answers.json`）の説明を追加
  - AI検証が必要なフィールド（`title`, `note`）の説明を追加
  - 期待フィールドのレベル別定義を実装に合わせて更新
  - 評価指標を実装に合わせて更新（信頼度スコアの非推奨化）
  - テストデータファイルの作成・編集ガイドラインを追加
